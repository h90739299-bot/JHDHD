-- Mobile Fly & Platform Script for Roblox with Anti-Cheat Protection
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local Character = player.Character or player.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local RootPart = Character:WaitForChild("HumanoidRootPart")

-- Advanced Anti-Cheat Protection System
local AntiAntiCheat = {
    Enabled = true,
    LastHealth = 100,
    LastPosition = RootPart.Position
}

-- Anti-cheat bypass
if not RunService:IsStudio() then
    pcall(function()
        -- Remove common anti-cheat systems
        local ReplicatedStorage = game:GetService("ReplicatedStorage")
        local ServerScriptService = game:GetService("ServerScriptService")
        
        local antiCheatLocations = {
            ReplicatedStorage,
            ServerScriptService,
            workspace
        }
        
        local antiCheatNames = {"AntiCheat", "AC", "Security", "AntiExploit", "AntiHack"}
        
        for _, location in pairs(antiCheatLocations) do
            for _, name in pairs(antiCheatNames) do
                local ac = location:FindFirstChild(name)
                if ac then
                    ac:Destroy()
                    warn("Anti-Cheat removed: " .. name)
                end
            end
        end
    end)
end

-- Create mobile-friendly GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MobileFlyMenu"
ScreenGui.Parent = game:GetService("CoreGui")

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0.35, 0, 0.3, 0)
MainFrame.Position = UDim2.new(0.02, 0, 0.02, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
MainFrame.BorderSizePixel = 2
MainFrame.BorderColor3 = Color3.fromRGB(100, 100, 100)
MainFrame.Parent = ScreenGui

-- Variables
local FlyToggled = false
local FlySpeed = 25
local BodyGyro = nil
local BodyVelocity = nil
local PlatformWalk = false
local LastPlatform = nil
local PlatformCooldown = 0.1
local lastPlatformTime = 0

-- Check if we're on mobile
local IsMobile = UserInputService.TouchEnabled

-- GUI elements table
local GuiElements = {}

-- Safe function to update text
local function SafeSetText(element, text)
    if element and element.Parent then
        element.Text = text
    end
end

-- Create button function
local function CreateButton(text, yPosition, callback, width, xPosition)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(width or 0.9, 0, 0.2, 0)
    button.Position = UDim2.new(xPosition or 0.05, 0, yPosition, 0)
    button.Text = text
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    button.BorderSizePixel = 0
    button.TextSize = IsMobile and 12 or 14
    button.Parent = MainFrame
    
    button.MouseButton1Click:Connect(function()
        pcall(callback)
    end)
    return button
end

-- Anti-Cheat Protection Button
GuiElements.antiCheatButton = CreateButton("ANTI-CHEAT: ON", 0.05, function()
    AntiAntiCheat.Enabled = not AntiAntiCheat.Enabled
    if AntiAntiCheat.Enabled then
        SafeSetText(GuiElements.antiCheatButton, "ANTI-CHEAT: ON")
        GuiElements.antiCheatButton.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
    else
        SafeSetText(GuiElements.antiCheatButton, "ANTI-CHEAT: OFF")
        GuiElements.antiCheatButton.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
    end
end, 0.4)

-- Fly Button
GuiElements.flyButton = CreateButton("FLY: OFF", 0.05, function()
    FlyToggled = not FlyToggled
    
    if FlyToggled then
        -- Remove old physics objects if they exist
        if BodyGyro then BodyGyro:Destroy() end
        if BodyVelocity then BodyVelocity:Destroy() end
        
        BodyGyro = Instance.new("BodyGyro")
        BodyGyro.P = 10000
        BodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
        BodyGyro.CFrame = RootPart.CFrame
        BodyGyro.Parent = RootPart

        BodyVelocity = Instance.new("BodyVelocity")
        BodyVelocity.Velocity = Vector3.new(0, 0, 0)
        BodyVelocity.MaxForce = Vector3.new(9e9, 9e9, 9e9)
        BodyVelocity.Parent = RootPart
        
        SafeSetText(GuiElements.flyButton, "FLY: ON")
        GuiElements.flyButton.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
    else
        if BodyGyro then BodyGyro:Destroy() end
        if BodyVelocity then BodyVelocity:Destroy() end
        SafeSetText(GuiElements.flyButton, "FLY: OFF")
        GuiElements.flyButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    end
end, 0.4, 0.5)

-- Platform Walk Button
GuiElements.platformButton = CreateButton("PLATFORM: OFF", 0.3, function()
    PlatformWalk = not PlatformWalk
    if PlatformWalk then
        SafeSetText(GuiElements.platformButton, "PLATFORM: ON")
        GuiElements.platformButton.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
    else
        SafeSetText(GuiElements.platformButton, "PLATFORM: OFF")
        GuiElements.platformButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
        
        -- Remove platform when turning off
        if LastPlatform and LastPlatform.Parent then
            LastPlatform:Destroy()
            LastPlatform = nil
        end
    end
end, 0.4, 0.05)

-- NoClip Button
GuiElements.noclipButton = CreateButton("NOCLIP: OFF", 0.3, function()
    local noclipEnabled = not Workspace.CurrentCamera:FindFirstChild("Noclip")
    
    if noclipEnabled then
        local noclipPart = Instance.new("Part")
        noclipPart.Name = "Noclip"
        noclipPart.Size = Vector3.new(2, 2, 2)
        noclipPart.Transparency = 1
        noclipPart.CanCollide = false
        noclipPart.Anchored = true
        noclipPart.Parent = Workspace.CurrentCamera
        
        SafeSetText(GuiElements.noclipButton, "NOCLIP: ON")
        GuiElements.noclipButton.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
    else
        local noclipPart = Workspace.CurrentCamera:FindFirstChild("Noclip")
        if noclipPart then
            noclipPart:Destroy()
        end
        
        SafeSetText(GuiElements.noclipButton, "NOCLIP: OFF")
        GuiElements.noclipButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    end
end, 0.4, 0.5)

-- Speed Control Button
GuiElements.speedButton = CreateButton("SPEED: " .. FlySpeed, 0.55, function()
    FlySpeed = FlySpeed + 5
    if FlySpeed > 50 then
        FlySpeed = 10
    end
    SafeSetText(GuiElements.speedButton, "SPEED: " .. FlySpeed)
end, 0.8, 0.05)

-- Create mobile flight controls if on mobile
local mobileUp = false
local mobileDown = false
local mobileForward = false
local mobileBackward = false
local mobileLeft = false
local mobileRight = false

if IsMobile then
    local touchGui = Instance.new("ScreenGui")
    touchGui.Name = "MobileFlightControls"
    touchGui.Parent = game:GetService("CoreGui")
    
    -- Up button
    local upButton = Instance.new("TextButton")
    upButton.Size = UDim2.new(0.12, 0, 0.12, 0)
    upButton.Position = UDim2.new(0.8, 0, 0.7, 0)
    upButton.Text = "↑"
    upButton.TextSize = 24
    upButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    upButton.BorderSizePixel = 2
    upButton.BorderColor3 = Color3.fromRGB(255, 255, 255)
    upButton.Parent = touchGui
    
    -- Down button
    local downButton = Instance.new("TextButton")
    downButton.Size = UDim2.new(0.12, 0, 0.12, 0)
    downButton.Position = UDim2.new(0.8, 0, 0.85, 0)
    downButton.Text = "↓"
    downButton.TextSize = 24
    downButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    downButton.BorderSizePixel = 2
    downButton.BorderColor3 = Color3.fromRGB(255, 255, 255)
    downButton.Parent = touchGui
    
    -- Forward button
    local forwardButton = Instance.new("TextButton")
    forwardButton.Size = UDim2.new(0.12, 0, 0.12, 0)
    forwardButton.Position = UDim2.new(0.65, 0, 0.7, 0)
    forwardButton.Text = "→"
    forwardButton.TextSize = 24
    forwardButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    forwardButton.BorderSizePixel = 2
    forwardButton.BorderColor3 = Color3.fromRGB(255, 255, 255)
    forwardButton.Parent = touchGui
    
    -- Backward button
    local backwardButton = Instance.new("TextButton")
    backwardButton.Size = UDim2.new(0.12, 0, 0.12, 0)
    backwardButton.Position = UDim2.new(0.5, 0, 0.7, 0)
    backwardButton.Text = "←"
    backwardButton.TextSize = 24
    backwardButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    backwardButton.BorderSizePixel = 2
    backwardButton.BorderColor3 = Color3.fromRGB(255, 255, 255)
    backwardButton.Parent = touchGui
    
    -- Left button
    local leftButton = Instance.new("TextButton")
    leftButton.Size = UDim2.new(0.12, 0, 0.12, 0)
    leftButton.Position = UDim2.new(0.65, 0, 0.55, 0)
    leftButton.Text = "↶"
    leftButton.TextSize = 24
    leftButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    leftButton.BorderSizePixel = 2
    leftButton.BorderColor3 = Color3.fromRGB(255, 255, 255)
    leftButton.Parent = touchGui
    
    -- Right button
    local rightButton = Instance.new("TextButton")
    rightButton.Size = UDim2.new(0.12, 0, 0.12, 0)
    rightButton.Position = UDim2.new(0.65, 0, 0.85, 0)
    rightButton.Text = "↷"
    rightButton.TextSize = 24
    rightButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    rightButton.BorderSizePixel = 2
    rightButton.BorderColor3 = Color3.fromRGB(255, 255, 255)
    rightButton.Parent = touchGui
    
    -- Mobile control variables
    upButton.MouseButton1Down:Connect(function() mobileUp = true end)
    upButton.MouseButton1Up:Connect(function() mobileUp = false end)
    downButton.MouseButton1Down:Connect(function() mobileDown = true end)
    downButton.MouseButton1Up:Connect(function() mobileDown = false end)
    forwardButton.MouseButton1Down:Connect(function() mobileForward = true end)
    forwardButton.MouseButton1Up:Connect(function() mobileForward = false end)
    backwardButton.MouseButton1Down:Connect(function() mobileBackward = true end)
    backwardButton.MouseButton1Up:Connect(function() mobileBackward = false end)
    leftButton.MouseButton1Down:Connect(function() mobileLeft = true end)
    leftButton.MouseButton1Up:Connect(function() mobileLeft = false end)
    rightButton.MouseButton1Down:Connect(function() mobileRight = true end)
    rightButton.MouseButton1Up:Connect(function() mobileRight = false end)
end

-- Anti-Kick and Anti-Death Protection
local function SetupAntiCheatProtection()
    -- Prevent character from dying
    if Humanoid then
        Humanoid.HealthChanged:Connect(function()
            if AntiAntiCheat.Enabled and Humanoid.Health < 10 then
                Humanoid.Health = 100
            end
        end)
    end
    
    -- Prevent unexpected position changes (jail teleport)
    if RootPart then
        RootPart:GetPropertyChangedSignal("Position"):Connect(function()
            if AntiAntiCheat.Enabled then
                local distance = (RootPart.Position - AntiAntiCheat.LastPosition).Magnitude
                if distance > 100 then
                    delay(0.5, function()
                        if RootPart and RootPart.Parent then
                            RootPart.CFrame = CFrame.new(AntiAntiCheat.LastPosition)
                        end
                    end)
                end
                AntiAntiCheat.LastPosition = RootPart.Position
            end
        end)
    end
    
    -- Reconnect if kicked
    Players.PlayerRemoving:Connect(function(leavingPlayer)
        if AntiAntiCheat.Enabled and leavingPlayer == player then
            wait(3)
            game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, game.JobId, player)
        end
    end)
end

-- Initialize anti-cheat protection
SetupAntiCheatProtection()

-- Flight control and platform system
RunService.Heartbeat:Connect(function(deltaTime)
    -- Update anti-cheat protection
    if AntiAntiCheat.Enabled then
        AntiAntiCheat.LastHealth = Humanoid.Health
        AntiAntiCheat.LastPosition = RootPart.Position
    end
    
    -- Handle flight
    if FlyToggled then
        -- Ensure physics objects exist
        if not BodyGyro or not BodyVelocity or not BodyGyro.Parent or not BodyVelocity.Parent then
            if RootPart and RootPart.Parent then
                BodyGyro = Instance.new("BodyGyro")
                BodyGyro.P = 10000
                BodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
                BodyGyro.CFrame = RootPart.CFrame
                BodyGyro.Parent = RootPart

                BodyVelocity = Instance.new("BodyVelocity")
                BodyVelocity.Velocity = Vector3.new(0, 0, 0)
                BodyVelocity.MaxForce = Vector3.new(9e9, 9e9, 9e9)
                BodyVelocity.Parent = RootPart
            end
        end
        
        -- Flight controls
        if BodyGyro and BodyVelocity and RootPart and RootPart.Parent then
            local camera = Workspace.CurrentCamera
            if camera then
                BodyGyro.CFrame = camera.CFrame
                
                local moveDirection = Vector3.new(0, 0, 0)
                
                -- Keyboard controls (WASD and Arrow Keys)
                if UserInputService:IsKeyDown(Enum.KeyCode.W) or UserInputService:IsKeyDown(Enum.KeyCode.Up) then
                    moveDirection = moveDirection + (camera.CFrame.LookVector * FlySpeed)
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.S) or UserInputService:IsKeyDown(Enum.KeyCode.Down) then
                    moveDirection = moveDirection - (camera.CFrame.LookVector * FlySpeed)
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.D) or UserInputService:IsKeyDown(Enum.KeyCode.Right) then
                    moveDirection = moveDirection + (camera.CFrame.RightVector * FlySpeed)
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.A) or UserInputService:IsKeyDown(Enum.KeyCode.Left) then
                    moveDirection = moveDirection - (camera.CFrame.RightVector * FlySpeed)
                end
                
                -- Mobile controls
                if IsMobile then
                    if mobileForward then
                        moveDirection = moveDirection + (camera.CFrame.LookVector * FlySpeed)
                    end
                    if mobileBackward then
                        moveDirection = moveDirection - (camera.CFrame.LookVector * FlySpeed)
                    end
                    if mobileRight then
                        moveDirection = moveDirection + (camera.CFrame.RightVector * FlySpeed)
                    end
                    if mobileLeft then
                        moveDirection = moveDirection - (camera.CFrame.RightVector * FlySpeed)
                    end
                    if mobileUp then
                        moveDirection = moveDirection + Vector3.new(0, FlySpeed, 0)
                    end
                    if mobileDown then
                        moveDirection = moveDirection - Vector3.new(0, FlySpeed, 0)
                    end
                end
                
                BodyVelocity.Velocity = moveDirection
            end
        end
    end
    
    -- Platform walk system - faster spawning
    if PlatformWalk and not FlyToggled and Humanoid and Humanoid.FloorMaterial == Enum.Material.Air then
        local currentTime = tick()
        if currentTime - lastPlatformTime >= PlatformCooldown then
            lastPlatformTime = currentTime
            
            -- Remove old platform if it exists
            if LastPlatform and LastPlatform.Parent then
                LastPlatform:Destroy()
            end
            
            -- Create a new platform below the player
            local platform = Instance.new("Part")
            platform.Size = Vector3.new(8, 1, 8)  -- Larger platform
            platform.Position = RootPart.Position - Vector3.new(0, 3.5, 0)  -- Closer to player
            platform.Anchored = true
            platform.CanCollide = true
            platform.Transparency = 0.4
            platform.BrickColor = BrickColor.new("Bright blue")
            platform.Material = Enum.Material.Neon
            platform.Name = "PlayerPlatform"
            platform.Parent = Workspace
            
            LastPlatform = platform
            
            -- Remove platform after a short time
            delay(1.2, function()
                if platform and platform.Parent then
                    platform:Destroy()
                end
            end)
        end
    elseif LastPlatform and LastPlatform.Parent then
        -- Remove platform when we're back on ground
        LastPlatform:Destroy()
        LastPlatform = nil
    end
    
    -- NoClip functionality
    local noclipPart = Workspace.CurrentCamera:FindFirstChild("Noclip")
    if noclipPart and Character then
        for _, part in pairs(Character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end
end)

-- Character respawn handling
player.CharacterAdded:Connect(function(newCharacter)
    Character = newCharacter
    Humanoid = newCharacter:WaitForChild("Humanoid")
    RootPart = newCharacter:WaitForChild("HumanoidRootPart")
    
    -- Re-enable flight if it was active
    if FlyToggled then
        FlyToggled = false
        delay(0.5, function()
            FlyToggled = true
            if BodyGyro then BodyGyro:Destroy() end
            if BodyVelocity then BodyVelocity:Destroy() end
        end)
    end
end)

print("✅ Mobile Fly & Platform with Anti-Cheat loaded successfully!")
print("📱 Mobile controls: " .. tostring(IsMobile))
print("🛡️ Anti-Cheat protection: " .. tostring(AntiAntiCheat.Enabled))

-- Instructions
warn("=== INSTRUCTIONS ===")
warn("FLY: W/A/S/D or Arrow Keys for movement")
warn("PLATFORM: Creates platforms when walking in air")
warn("NOCLIP: Walk through walls")
warn("ANTI-CHEAT: Prevents kicks and deaths")
